!function(){"use strict";angular.module("lazyGoogleMaps",[])}(),function(e){try{e=angular.module("lazyGoogleMaps")}catch(o){e=angular.module("lazyGoogleMaps",[])}e.run(["$templateCache",function(e){e.put("map/map.html",'<div class="lazy-google-maps"><input id="lazy-google-maps-search-{{$id}}" class="lazy-google-maps-search" type="text" placeholder="Search for a place..."><div id="lazy-google-maps-canvas-{{$id}}" class="lazy-google-maps-canvas"></div></div>')}])}(),function(){"use strict";function e(e,o,t,a){function n(n){function c(){var t=o.defer(),l=["sensor=false","callback=mapLoaded","libraries=places"],c="https://maps.googleapis.com/maps/api/js?"+l.join("&"),i=document.createElement("script");return i.type="text/javascript",i.src=c,a.isLoading?(n.$on("lazyGoogleMaps:loaded",r),t.reject(),t.promise):(document.body.appendChild(i),a.isLoading=!0,e.mapLoaded=function(){t.resolve()},t.promise)}function r(){var e,o;y=google.maps,e={zoom:8},f=new y.Map(document.getElementById("lazy-google-maps-canvas-"+n.$id),e),v=new y.Marker({map:f}),h=new google.maps.InfoWindow,p(),g(),o=n.$watchGroup(["lat","lng"],function(e){var t;return e[0]&&e[0]?(i(),o()):void(t=n.$watchGroup(["city","country","place"],function(e){return e[0]||e[1]||e[2]?(o(),s(),t()):void 0}))})}function i(){var e=n.lat+","+n.lng;a.reverseGeocode(e).then(function(e){e&&u(e)})}function s(){var e=(n.city||"")+" "+(n.country||"")+" "+(n.place||"");a.geocode(e).then(function(e){e&&u(e)})}function p(){var e=new google.maps.places.SearchBox(z);z=document.getElementById("lazy-google-maps-search-"+n.$id),f.controls[y.ControlPosition.TOP_LEFT].push(z),y.event.addListener(e,"places_changed",function(){var o=e.getPlaces()[0];o&&u(o)})}function g(){y.event.addListener(f,"click",function(e){var o=e.latLng.A+","+e.latLng.F;a.reverseGeocode(o).then(function(e){e&&u(e)})})}function u(e){var o,t=new y.LatLngBounds;d(e),h.close(),l.has(e,"geometry.viewport.Da")?f.fitBounds(e.geometry.viewport):l.has(e,"geometry.location.A")&&(t.extend(e.geometry.location),f.fitBounds(t)),f.panTo(e.geometry.location),n.place=e.formatted_address,n.lat=e.geometry.location.A||e.geometry.location.lat,n.lng=e.geometry.location.F||e.geometry.location.lng,z.value=n.place,m(e),o="<div><strong>"+n.city+"</strong><br>"+n.place+"</div>",h.setContent(o),h.open(f,v)}function d(e){var o={url:e.icon,size:new y.Size(71,71),origin:new y.Point(0,0),anchor:new y.Point(17,34),scaledSize:new y.Size(35,35)},t=e.geometry.location;e.icon&&v.setIcon(o),v.setPosition(t),v.setVisible(!0)}function m(e){var o=l.filter(e.address_components,{types:["country"]}),t=l.filter(e.address_components,{types:["locality"]});n.country=o[0]?o[0].long_name:n.place,n.city=t[0]?t[0].long_name:n.country}var y,f,v,h,z;return y?r():void c().then(function(){t.$broadcast("lazyGoogleMaps:loaded"),r()})}var l=e._,c={restrict:"E",scope:{lat:"=?",lng:"=?",country:"=?",city:"=?",place:"=?"},replace:!0,templateUrl:"map/map.html",link:n};return c}angular.module("lazyGoogleMaps").directive("lazyGoogleMaps",e),e.$inject=["$window","$q","$rootScope","lazyGoogleMapsUtils"]}(),function(){"use strict";function e(e){function o(o){var t="https://maps.googleapis.com/maps/api/geocode/json?latlng=";return e.get(t+o).then(function(e){return e.data.results[0]})}function t(o){var t="https://maps.googleapis.com/maps/api/geocode/json?address=";return e.get(t+o).then(function(e){return e.data.results[0]})}var a={isLoading:!1,reverseGeocode:o,geocode:t};return a}angular.module("lazyGoogleMaps").factory("lazyGoogleMapsUtils",e),e.$inject=["$http"]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1hcC9tYXAuanMiLCJtYXAvbWFwLmRpcmVjdGl2ZS5qcyIsIm1hcC9tYXAuc2VydmljZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZSIsInJ1biIsIiR0ZW1wbGF0ZUNhY2hlIiwicHV0IiwibGF6eUdvb2dsZU1hcHMiLCIkd2luZG93IiwiJHEiLCIkcm9vdFNjb3BlIiwibGF6eUdvb2dsZU1hcHNVdGlscyIsImxpbmsiLCJzY29wZSIsImluamVjdE1hcCIsImRlZmVycmVkIiwiZGVmZXIiLCJvcHRpb25zIiwic291cmNlIiwiam9pbiIsInNjcmlwdFRhZyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInR5cGUiLCJzcmMiLCJpc0xvYWRpbmciLCIkb24iLCJyZW5kZXJNYXAiLCJyZWplY3QiLCJwcm9taXNlIiwiYm9keSIsImFwcGVuZENoaWxkIiwibWFwTG9hZGVkIiwicmVzb2x2ZSIsIm1hcE9wdGlvbnMiLCJ3YXRjaExhdExuZyIsIm1hcHMiLCJnb29nbGUiLCJ6b29tIiwicmVuZGVyZWRNYXAiLCJNYXAiLCJnZXRFbGVtZW50QnlJZCIsIiRpZCIsIm1hcmtlciIsIk1hcmtlciIsIm1hcCIsImluZm93aW5kb3ciLCJJbmZvV2luZG93IiwicmVuZGVyUGxhY2VTZWFyY2giLCJhZGRDbGlja0xpc3RlbmVyIiwiJHdhdGNoR3JvdXAiLCJjb29yZGluYXRlcyIsIndhdGNoQWRkcmVzcyIsInBsYWNlTWFya2VyQnlMYXRMbmciLCJhZGRyZXNzIiwicGxhY2VNYXJrZXJCeUFkZHJlc3MiLCJsYXRMbmciLCJsYXQiLCJsbmciLCJyZXZlcnNlR2VvY29kZSIsInRoZW4iLCJwbGFjZSIsInByb2Nlc3NQbGFjZSIsImNpdHkiLCJjb3VudHJ5IiwiZ2VvY29kZSIsInNlYXJjaEJveCIsInBsYWNlcyIsIlNlYXJjaEJveCIsInNlYXJjaElucHV0IiwiY29udHJvbHMiLCJDb250cm9sUG9zaXRpb24iLCJUT1BfTEVGVCIsInB1c2giLCJldmVudCIsImFkZExpc3RlbmVyIiwiZ2V0UGxhY2VzIiwidGFyZ2V0IiwiQSIsIkYiLCJpbmZvV2luZG93Q29udGVudCIsImJvdW5kcyIsIkxhdExuZ0JvdW5kcyIsInNldE1hcmtlciIsImNsb3NlIiwiXyIsImhhcyIsImZpdEJvdW5kcyIsImdlb21ldHJ5Iiwidmlld3BvcnQiLCJleHRlbmQiLCJsb2NhdGlvbiIsInBhblRvIiwiZm9ybWF0dGVkX2FkZHJlc3MiLCJ2YWx1ZSIsInByb2Nlc3NBZGRyZXNzQ29tcG9uZW50cyIsInNldENvbnRlbnQiLCJvcGVuIiwibWFya2VySW1hZ2UiLCJ1cmwiLCJpY29uIiwic2l6ZSIsIlNpemUiLCJvcmlnaW4iLCJQb2ludCIsImFuY2hvciIsInNjYWxlZFNpemUiLCJwb3NpdGlvbiIsInNldEljb24iLCJzZXRQb3NpdGlvbiIsInNldFZpc2libGUiLCJmaWx0ZXIiLCJhZGRyZXNzX2NvbXBvbmVudHMiLCJ0eXBlcyIsImxvbmdfbmFtZSIsIiRicm9hZGNhc3QiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInJlcGxhY2UiLCJ0ZW1wbGF0ZVVybCIsIiRpbmplY3QiLCIkaHR0cCIsImdvb2dsZUdlb2NvZGVTZXJ2aWNlVVJMIiwiZ2V0IiwicmVzcG9uc2UiLCJkYXRhIiwicmVzdWx0cyIsInNlcnZpY2UiLCJmYWN0b3J5Il0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLFlBRUFBLFNBQUFDLE9BQUEsd0JDSEEsU0FBQUEsR0FDQSxJQUNBQSxFQUFBRCxRQUFBQyxPQUFBLGtCQUNBLE1BQUFDLEdBQ0FELEVBQUFELFFBQUFDLE9BQUEscUJBRUFBLEVBQUFFLEtBQUEsaUJBQUEsU0FBQUMsR0FDQUEsRUFBQUMsSUFBQSxlQUNBLDBQQ1JBLFdBQ0EsWUFNQSxTQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQWtCQSxRQUFBQyxHQUFBQyxHQWlCQSxRQUFBQyxLQUNBLEdBQUFDLEdBQUFOLEVBQUFPLFFBQ0FDLEdBQUEsZUFBQSxxQkFBQSxvQkFDQUMsRUFB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QSxTQUFBN0csR0FBQThHLEdBU0EsUUFBQTlELEdBQUFILEdBQ0EsR0FBQWtFLEdBQUEsMkRBQ0EsT0FBQUQsR0FBQUUsSUFBQUQsRUFBQWxFLEdBQUFJLEtBQUEsU0FBQWdFLEdBQ0EsTUFBQUEsR0FBQUMsS0FBQUMsUUFBQSxLQUtBLFFBQUE3RCxHQUFBWCxHQUNBLEdBQUFvRSxHQUFBLDREQUNBLE9BQUFELEdBQUFFLElBQUFELEVBQUFwRSxHQUFBTSxLQUFBLFNBQUFnRSxHQUNBLE1BQUFBLEdBQUFDLEtBQUFDLFFBQUEsS0FuQkEsR0FBQUMsSUFDQXRHLFdBQUEsRUFDQWtDLGVBQUFBLEVBQ0FNLFFBQUFBLEVBR0EsT0FBQThELEdBWEE5SCxRQUNBQyxPQUFBLGtCQUNBOEgsUUFBQSxzQkFBQXJILEdBMkJBQSxFQUFBNkcsU0FBQSIsImZpbGUiOiJsYXp5R29vZ2xlTWFwcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdsYXp5R29vZ2xlTWFwcycsIFtdKTtcblxufSkoKTtcbiIsIihmdW5jdGlvbihtb2R1bGUpIHtcbnRyeSB7XG4gIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdsYXp5R29vZ2xlTWFwcycpO1xufSBjYXRjaCAoZSkge1xuICBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnbGF6eUdvb2dsZU1hcHMnLCBbXSk7XG59XG5tb2R1bGUucnVuKFsnJHRlbXBsYXRlQ2FjaGUnLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkge1xuICAkdGVtcGxhdGVDYWNoZS5wdXQoJ21hcC9tYXAuaHRtbCcsXG4gICAgJzxkaXYgY2xhc3M9XCJsYXp5LWdvb2dsZS1tYXBzXCI+PGlucHV0IGlkPVwibGF6eS1nb29nbGUtbWFwcy1zZWFyY2gte3skaWR9fVwiIGNsYXNzPVwibGF6eS1nb29nbGUtbWFwcy1zZWFyY2hcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiU2VhcmNoIGZvciBhIHBsYWNlLi4uXCI+PGRpdiBpZD1cImxhenktZ29vZ2xlLW1hcHMtY2FudmFzLXt7JGlkfX1cIiBjbGFzcz1cImxhenktZ29vZ2xlLW1hcHMtY2FudmFzXCI+PC9kaXY+PC9kaXY+Jyk7XG59XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbGF6eUdvb2dsZU1hcHMnKVxuICAgICAgICAuZGlyZWN0aXZlKCdsYXp5R29vZ2xlTWFwcycsIGxhenlHb29nbGVNYXBzKTtcblxuICAgIGZ1bmN0aW9uIGxhenlHb29nbGVNYXBzICgkd2luZG93LCAkcSwgJHJvb3RTY29wZSwgbGF6eUdvb2dsZU1hcHNVdGlscykge1xuICAgICAgICB2YXIgXyA9ICR3aW5kb3cuXztcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGxhdDogJz0/JyxcbiAgICAgICAgICAgICAgICBsbmc6ICc9PycsXG4gICAgICAgICAgICAgICAgY291bnRyeTogJz0/JyxcbiAgICAgICAgICAgICAgICBjaXR5OiAnPT8nLFxuICAgICAgICAgICAgICAgIHBsYWNlOiAnPT8nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbWFwL21hcC5odG1sJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUpIHtcbiAgICAgICAgICAgIHZhciBtYXBzO1xuICAgICAgICAgICAgdmFyIHJlbmRlcmVkTWFwO1xuICAgICAgICAgICAgdmFyIG1hcmtlcjtcbiAgICAgICAgICAgIHZhciBpbmZvd2luZG93O1xuICAgICAgICAgICAgdmFyIHNlYXJjaElucHV0O1xuXG4gICAgICAgICAgICBpZiAobWFwcykge1xuICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJNYXAoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaW5qZWN0TWFwKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsYXp5R29vZ2xlTWFwczpsb2FkZWQnKTtcbiAgICAgICAgICAgICAgICByZW5kZXJNYXAoKTtcbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGluamVjdE1hcCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gWydzZW5zb3I9ZmFsc2UnLCAnY2FsbGJhY2s9bWFwTG9hZGVkJywgJ2xpYnJhcmllcz1wbGFjZXMnXTtcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9qcz8nICsgb3B0aW9ucy5qb2luKCcmJyk7XG4gICAgICAgICAgICAgICAgdmFyIHNjcmlwdFRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICAgICAgICAgIHNjcmlwdFRhZy50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICAgICAgICAgICAgc2NyaXB0VGFnLnNyYyA9IHNvdXJjZTtcblxuICAgICAgICAgICAgICAgIGlmIChsYXp5R29vZ2xlTWFwc1V0aWxzLmlzTG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kb24oJ2xhenlHb29nbGVNYXBzOmxvYWRlZCcsIHJlbmRlck1hcCk7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0VGFnKTtcbiAgICAgICAgICAgICAgICBsYXp5R29vZ2xlTWFwc1V0aWxzLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAkd2luZG93Lm1hcExvYWRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiByZW5kZXJNYXAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1hcE9wdGlvbnM7XG4gICAgICAgICAgICAgICAgdmFyIHdhdGNoTGF0TG5nO1xuICAgICAgICAgICAgICAgIG1hcHMgPSBnb29nbGUubWFwcztcbiAgICAgICAgICAgICAgICBtYXBPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICB6b29tOiA4XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZW5kZXJlZE1hcCA9IG5ldyBtYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGF6eS1nb29nbGUtbWFwcy1jYW52YXMtJyArIHNjb3BlLiRpZCksIG1hcE9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIG1hcmtlciA9IG5ldyBtYXBzLk1hcmtlcih7IG1hcDogcmVuZGVyZWRNYXAgfSk7XG4gICAgICAgICAgICAgICAgaW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KCk7XG5cbiAgICAgICAgICAgICAgICByZW5kZXJQbGFjZVNlYXJjaCgpO1xuICAgICAgICAgICAgICAgIGFkZENsaWNrTGlzdGVuZXIoKTtcblxuICAgICAgICAgICAgICAgIHdhdGNoTGF0TG5nID0gc2NvcGUuJHdhdGNoR3JvdXAoWydsYXQnLCAnbG5nJ10sIGZ1bmN0aW9uIChjb29yZGluYXRlcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgd2F0Y2hBZGRyZXNzO1xuICAgICAgICAgICAgICAgICAgICBpZihjb29yZGluYXRlc1swXSAmJiBjb29yZGluYXRlc1swXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VNYXJrZXJCeUxhdExuZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdhdGNoTGF0TG5nKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB3YXRjaEFkZHJlc3MgPSBzY29wZS4kd2F0Y2hHcm91cChbJ2NpdHknLCAnY291bnRyeScsICdwbGFjZSddLCBmdW5jdGlvbiAoYWRkcmVzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFkZHJlc3NbMF0gfHwgYWRkcmVzc1sxXSB8fCBhZGRyZXNzWzJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2F0Y2hMYXRMbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZU1hcmtlckJ5QWRkcmVzcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3YXRjaEFkZHJlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHBsYWNlTWFya2VyQnlMYXRMbmcoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhdExuZyA9IHNjb3BlLmxhdCArICcsJyArIHNjb3BlLmxuZztcblxuICAgICAgICAgICAgICAgIGxhenlHb29nbGVNYXBzVXRpbHMucmV2ZXJzZUdlb2NvZGUobGF0TG5nKS50aGVuKGZ1bmN0aW9uIChwbGFjZSkge1xuICAgICAgICAgICAgICAgICAgICBpZihwbGFjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1BsYWNlKHBsYWNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwbGFjZU1hcmtlckJ5QWRkcmVzcygpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWRkcmVzcyA9IChzY29wZS5jaXR5IHx8ICcnKSArICcgJyArIChzY29wZS5jb3VudHJ5IHx8ICcnKSArICcgJyArIChzY29wZS5wbGFjZSB8fCAnJyk7XG5cbiAgICAgICAgICAgICAgICBsYXp5R29vZ2xlTWFwc1V0aWxzLmdlb2NvZGUoYWRkcmVzcykudGhlbihmdW5jdGlvbiAocGxhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocGxhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NQbGFjZShwbGFjZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiByZW5kZXJQbGFjZVNlYXJjaCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoQm94ID0gbmV3IGdvb2dsZS5tYXBzLnBsYWNlcy5TZWFyY2hCb3goKHNlYXJjaElucHV0KSk7XG4gICAgICAgICAgICAgICAgc2VhcmNoSW5wdXQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhenktZ29vZ2xlLW1hcHMtc2VhcmNoLScgKyBzY29wZS4kaWQpKTtcblxuICAgICAgICAgICAgICAgIHJlbmRlcmVkTWFwLmNvbnRyb2xzW21hcHMuQ29udHJvbFBvc2l0aW9uLlRPUF9MRUZUXS5wdXNoKHNlYXJjaElucHV0KTtcblxuICAgICAgICAgICAgICAgIG1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoc2VhcmNoQm94LCAncGxhY2VzX2NoYW5nZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsYWNlID0gc2VhcmNoQm94LmdldFBsYWNlcygpWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghcGxhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NQbGFjZShwbGFjZSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiBhZGRDbGlja0xpc3RlbmVyKCkge1xuICAgICAgICAgICAgICAgIG1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocmVuZGVyZWRNYXAsICdjbGljaycsIGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGF0TG5nID0gdGFyZ2V0LmxhdExuZy5BICsgJywnICsgdGFyZ2V0LmxhdExuZy5GO1xuXG4gICAgICAgICAgICAgICAgICAgIGxhenlHb29nbGVNYXBzVXRpbHMucmV2ZXJzZUdlb2NvZGUobGF0TG5nKS50aGVuKGZ1bmN0aW9uIChwbGFjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocGxhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzUGxhY2UocGxhY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzUGxhY2UocGxhY2UpIHtcblxuICAgICAgICAgICAgICAgIHZhciBib3VuZHMgPSBuZXcgbWFwcy5MYXRMbmdCb3VuZHMoKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5mb1dpbmRvd0NvbnRlbnQ7XG5cbiAgICAgICAgICAgICAgICBzZXRNYXJrZXIocGxhY2UpO1xuXG4gICAgICAgICAgICAgICAgaW5mb3dpbmRvdy5jbG9zZSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKF8uaGFzKHBsYWNlLCAnZ2VvbWV0cnkudmlld3BvcnQuRGEnKSkge1xuICAgICAgICAgICAgICAgICAgICByZW5kZXJlZE1hcC5maXRCb3VuZHMocGxhY2UuZ2VvbWV0cnkudmlld3BvcnQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXy5oYXMocGxhY2UsICdnZW9tZXRyeS5sb2NhdGlvbi5BJykpIHtcbiAgICAgICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVkTWFwLmZpdEJvdW5kcyhib3VuZHMpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJlbmRlcmVkTWFwLnBhblRvKHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uKTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLnBsYWNlID0gcGxhY2UuZm9ybWF0dGVkX2FkZHJlc3M7XG4gICAgICAgICAgICAgICAgc2NvcGUubGF0ID0gcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24uQSB8fCBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sYXQ7XG4gICAgICAgICAgICAgICAgc2NvcGUubG5nID0gcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24uRiB8fCBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sbmc7XG5cbiAgICAgICAgICAgICAgICBzZWFyY2hJbnB1dC52YWx1ZSA9IHNjb3BlLnBsYWNlO1xuXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0FkZHJlc3NDb21wb25lbnRzKHBsYWNlKTtcblxuICAgICAgICAgICAgICAgIGluZm9XaW5kb3dDb250ZW50ID0gJzxkaXY+PHN0cm9uZz4nICsgc2NvcGUuY2l0eSArICc8L3N0cm9uZz48YnI+JyArIHNjb3BlLnBsYWNlICsgJzwvZGl2Pic7XG4gICAgICAgICAgICAgICAgaW5mb3dpbmRvdy5zZXRDb250ZW50KGluZm9XaW5kb3dDb250ZW50KTtcbiAgICAgICAgICAgICAgICBpbmZvd2luZG93Lm9wZW4ocmVuZGVyZWRNYXAsIG1hcmtlcik7XG5cbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRNYXJrZXIocGxhY2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWFya2VySW1hZ2UgPSB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogcGxhY2UuaWNvbixcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogbmV3IG1hcHMuU2l6ZSg3MSwgNzEpLFxuICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBtYXBzLlBvaW50KDAsIDApLFxuICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBtYXBzLlBvaW50KDE3LCAzNCksXG4gICAgICAgICAgICAgICAgICAgIHNjYWxlZFNpemU6IG5ldyBtYXBzLlNpemUoMzUsIDM1KVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gcGxhY2UuZ2VvbWV0cnkubG9jYXRpb247XG4gICAgICAgICAgICAgICAgaWYgKHBsYWNlLmljb24pIHtcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyLnNldEljb24oKG1hcmtlckltYWdlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1hcmtlci5zZXRQb3NpdGlvbihwb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgbWFya2VyLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0FkZHJlc3NDb21wb25lbnRzKHBsYWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnkgPSBfLmZpbHRlcihwbGFjZS5hZGRyZXNzX2NvbXBvbmVudHMsIHsgdHlwZXM6IFsnY291bnRyeSddIH0pO1xuICAgICAgICAgICAgICAgIHZhciBjaXR5ID0gXy5maWx0ZXIocGxhY2UuYWRkcmVzc19jb21wb25lbnRzLCB7IHR5cGVzOiBbJ2xvY2FsaXR5J10gfSk7XG5cbiAgICAgICAgICAgICAgICBzY29wZS5jb3VudHJ5ID0gY291bnRyeVswXSA/IGNvdW50cnlbMF0ubG9uZ19uYW1lIDogc2NvcGUucGxhY2U7XG4gICAgICAgICAgICAgICAgc2NvcGUuY2l0eSA9IGNpdHlbMF0gPyBjaXR5WzBdLmxvbmdfbmFtZSA6IHNjb3BlLmNvdW50cnk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGF6eUdvb2dsZU1hcHMuJGluamVjdCA9IFtcIiR3aW5kb3dcIiwgXCIkcVwiLCBcIiRyb290U2NvcGVcIiwgXCJsYXp5R29vZ2xlTWFwc1V0aWxzXCJdO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdsYXp5R29vZ2xlTWFwcycpXG4gICAgICAgIC5mYWN0b3J5KCdsYXp5R29vZ2xlTWFwc1V0aWxzJywgbGF6eUdvb2dsZU1hcHNVdGlscyk7XG5cbiAgICBmdW5jdGlvbiBsYXp5R29vZ2xlTWFwc1V0aWxzKCRodHRwKSB7XG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIHJldmVyc2VHZW9jb2RlOiByZXZlcnNlR2VvY29kZSxcbiAgICAgICAgICAgIGdlb2NvZGU6IGdlb2NvZGVcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICBmdW5jdGlvbiByZXZlcnNlR2VvY29kZShsYXRMbmcpIHtcbiAgICAgICAgICAgIHZhciBnb29nbGVHZW9jb2RlU2VydmljZVVSTCA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uP2xhdGxuZz0nO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChnb29nbGVHZW9jb2RlU2VydmljZVVSTCArIGxhdExuZykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5yZXN1bHRzWzBdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGZ1bmN0aW9uIGdlb2NvZGUoYWRkcmVzcykge1xuICAgICAgICAgICAgdmFyIGdvb2dsZUdlb2NvZGVTZXJ2aWNlVVJMID0gJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24/YWRkcmVzcz0nO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChnb29nbGVHZW9jb2RlU2VydmljZVVSTCArIGFkZHJlc3MpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEucmVzdWx0c1swXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9XG4gICAgbGF6eUdvb2dsZU1hcHNVdGlscy4kaW5qZWN0ID0gW1wiJGh0dHBcIl07XG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9