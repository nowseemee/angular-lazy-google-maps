!function(){"use strict";angular.module("lazyGoogleMaps",[])}(),function(e){try{e=angular.module("lazyGoogleMaps")}catch(o){e=angular.module("lazyGoogleMaps",[])}e.run(["$templateCache",function(e){e.put("map/map.html",'<div class="lazy-google-maps"><input id="lazy-google-maps-search-{{$id}}" ng-hide="customSearchElementId" class="lazy-google-maps-search" type="text" placeholder="Search for a place..."> <button ng-if="freezeButton" ng-disabled="isLoading" ng-class="{ \'freezed\': freezed }" ng-click="toggleFreezed()" id="button-{{ $id }}" class="random-button-element"><span ng-if="!freezed">Freeze</span> <span ng-if="freezed">Unfreeze</span></button><div id="lazy-google-maps-canvas-{{$id}}" class="lazy-google-maps-canvas"></div></div>')}])}(),function(){"use strict";function e(e,o,t,n){function a(a){function l(){v(),L.setOptions({disableDoubleClickZoom:!1,draggable:!1,scrollwheel:!1})}function i(){u(),L.setOptions({disableDoubleClickZoom:!0,draggable:!0,scrollwheel:!0})}function s(){var t=o.defer(),r=["sensor=false","callback=mapLoaded","libraries=places"],l="https://maps.googleapis.com/maps/api/js?"+r.join("&"),i=document.createElement("script");return i.type="text/javascript",i.src=l,n.isLoading?(a.$on("lazyGoogleMaps:loaded",c),t.reject(),t.promise):(document.body.appendChild(i),n.isLoading=!0,e.mapLoaded=function(){t.resolve()},t.promise)}function c(){var e,o;return z=google.maps,e={zoom:8,center:new google.maps.LatLng(-33.868001,151.195248),panControlOptions:{position:z.ControlPosition.LEFT_CENTER},zoomControlOptions:{position:z.ControlPosition.LEFT_CENTER},streetViewControlOptions:{position:z.ControlPosition.LEFT_CENTER}},L=new z.Map(document.getElementById("lazy-google-maps-canvas-"+a.$id),e),w=new z.Marker({map:L}),C=new google.maps.InfoWindow,p(),u(),a.isLoading=!1,a.freezed&&l(),a.markers?h():void(o=a.$watchGroup(["lat","lng"],function(e){var t;return e[0]&&e[0]?(g(),o()):void(t=a.$watchGroup(["city","country","place"],function(e){return e[0]||e[1]||e[2]?(o(),d(),t()):void 0}))}))}function g(){var e=a.lat+","+a.lng;n.reverseGeocode(e).then(function(e){e&&m(e)})}function d(){var e=(a.city||"")+" "+(a.country||"")+" "+(a.place||"");n.geocode(e).then(function(e){e&&m(e)})}function p(){function e(){return document.getElementById(a.customSearchElementId?a.customSearchElementId:"lazy-google-maps-search-"+a.$id)}var o;E=e(),o=new google.maps.places.SearchBox(E),a.customSearchElementId||L.controls[z.ControlPosition.TOP_LEFT].push(E),z.event.addListener(o,"places_changed",function(){var e=o.getPlaces()[0];e&&m(e)})}function u(){z.event.addListener(L,"click",function(e){var o=e.latLng.A+","+e.latLng.F;n.reverseGeocode(o).then(function(e){e&&m(e)})})}function m(e){var o;C.close(),r.has(e,"geometry.viewport.Da")&&L.fitBounds(e.geometry.viewport),L.panTo(e.geometry.location),a.markers||(f(e),a.place=e.formatted_address,a.lat=e.geometry.location.A||e.geometry.location.lat,a.lng=e.geometry.location.F||e.geometry.location.lng,E.value=a.place,y(e),o="<div><strong>"+a.city+"</strong><br>"+a.place+"</div>",C.setContent(o),C.open(L,w))}function f(e){var o=e.geometry.location;w.setPosition(o),w.setVisible(!0)}function y(e){var o=r.filter(e.address_components,{types:["country"]}),t=r.filter(e.address_components,{types:["locality"]});a.country=o[0]?o[0].long_name:a.place,a.city=t[0]?t[0].long_name:a.country}function v(){z.event.clearListeners(L,"click")}function h(){var e=new google.maps.LatLngBounds,o="http://chart.apis.google.com/chart?cht=mm&chs=24x32&chco=FFFFFF,008CFF,000000&ext=.png",t=new google.maps.MarkerImage(o,new google.maps.Size(24,32)),n=r.map(a.markers,function(o){var n=new google.maps.LatLng(o.lat,o.lng),a=new google.maps.Marker({position:n,icon:t,title:"Click to zoom"});return z.event.addListener(a,"click",function(){L.setZoom(17),L.setCenter(a.getPosition()),console.log(a)}),e.extend(n),a}),l={gridSize:90,maxZoom:15,styles:[{url:o,height:35,width:35,anchor:[16,0],textColor:"#ff00ff",textSize:10}]};b=new MarkerClusterer(L,n,l),L.fitBounds(e),b.redraw()}var z,L,w,C,E,b;return a.isLoading=!0,a.toggleFreezed=function(){return a.freezed=!a.freezed,a.freezed?l():void i()},z?c():void s().then(function(){t.$broadcast("lazyGoogleMaps:loaded"),c()})}var r=e._,l={restrict:"E",scope:{lat:"=?",lng:"=?",country:"=?",city:"=?",place:"=?",customSearchElementId:"=?",freezeButton:"=?",freezed:"=?",isLoading:"@",markers:"=?"},replace:!0,templateUrl:"map/map.html",link:a};return l}angular.module("lazyGoogleMaps").directive("lazyGoogleMaps",e),e.$inject=["$window","$q","$rootScope","lazyGoogleMapsUtils"]}(),function(){"use strict";function e(e){function o(o){var t="https://maps.googleapis.com/maps/api/geocode/json?latlng=";return e.get(t+o).then(function(e){return e.data.results[0]})}function t(o){var t="https://maps.googleapis.com/maps/api/geocode/json?address=";return e.get(t+o).then(function(e){return e.data.results[0]})}var n={isLoading:!1,reverseGeocode:o,geocode:t};return n}angular.module("lazyGoogleMaps").factory("lazyGoogleMapsUtils",e),e.$inject=["$http"]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1hcC9tYXAuanMiLCJtYXAvbWFwLmRpcmVjdGl2ZS5qcyIsIm1hcC9tYXAuc2VydmljZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZSIsInJ1biIsIiR0ZW1wbGF0ZUNhY2hlIiwicHV0IiwibGF6eUdvb2dsZU1hcHMiLCIkd2luZG93IiwiJHEiLCIkcm9vdFNjb3BlIiwibGF6eUdvb2dsZU1hcHNVdGlscyIsImxpbmsiLCJzY29wZSIsImZyZWV6ZSIsInJlbW92ZUNsaWNrTGlzdGVuZXIiLCJyZW5kZXJlZE1hcCIsInNldE9wdGlvbnMiLCJkaXNhYmxlRG91YmxlQ2xpY2tab29tIiwiZHJhZ2dhYmxlIiwic2Nyb2xsd2hlZWwiLCJ1bkZyZWV6ZSIsImFkZENsaWNrTGlzdGVuZXIiLCJpbmplY3RNYXAiLCJkZWZlcnJlZCIsImRlZmVyIiwib3B0aW9ucyIsInNvdXJjZSIsImpvaW4iLCJzY3JpcHRUYWciLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0eXBlIiwic3JjIiwiaXNMb2FkaW5nIiwiJG9uIiwicmVuZGVyTWFwIiwicmVqZWN0IiwicHJvbWlzZSIsImJvZHkiLCJhcHBlbmRDaGlsZCIsIm1hcExvYWRlZCIsInJlc29sdmUiLCJtYXBPcHRpb25zIiwid2F0Y2hMYXRMbmciLCJtYXBzIiwiZ29vZ2xlIiwiem9vbSIsImNlbnRlciIsIkxhdExuZyIsInBhbkNvbnRyb2xPcHRpb25zIiwicG9zaXRpb24iLCJDb250cm9sUG9zaXRpb24iLCJMRUZUX0NFTlRFUiIsInpvb21Db250cm9sT3B0aW9ucyIsInN0cmVldFZpZXdDb250cm9sT3B0aW9ucyIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiJGlkIiwibWFya2VyIiwiTWFya2VyIiwibWFwIiwiaW5mb3dpbmRvdyIsIkluZm9XaW5kb3ciLCJyZW5kZXJQbGFjZVNlYXJjaCIsImZyZWV6ZWQiLCJtYXJrZXJzIiwic2V0TWFya2VyQ2x1c3RlciIsIiR3YXRjaEdyb3VwIiwiY29vcmRpbmF0ZXMiLCJ3YXRjaEFkZHJlc3MiLCJwbGFjZU1hcmtlckJ5TGF0TG5nIiwiYWRkcmVzcyIsInBsYWNlTWFya2VyQnlBZGRyZXNzIiwibGF0TG5nIiwibGF0IiwibG5nIiwicmV2ZXJzZUdlb2NvZGUiLCJ0aGVuIiwicGxhY2UiLCJwcm9jZXNzUGxhY2UiLCJjaXR5IiwiY291bnRyeSIsImdlb2NvZGUiLCJnZXRTZWFyY2hJbnB1dCIsImN1c3RvbVNlYXJjaEVsZW1lbnRJZCIsInNlYXJjaEJveCIsInNlYXJjaElucHV0RWxlbWVudCIsInBsYWNlcyIsIlNlYXJjaEJveCIsImNvbnRyb2xzIiwiVE9QX0xFRlQiLCJwdXNoIiwiZXZlbnQiLCJhZGRMaXN0ZW5lciIsImdldFBsYWNlcyIsInRhcmdldCIsIkEiLCJGIiwiaW5mb1dpbmRvd0NvbnRlbnQiLCJjbG9zZSIsIl8iLCJoYXMiLCJmaXRCb3VuZHMiLCJnZW9tZXRyeSIsInZpZXdwb3J0IiwicGFuVG8iLCJsb2NhdGlvbiIsInNldE1hcmtlciIsImZvcm1hdHRlZF9hZGRyZXNzIiwidmFsdWUiLCJwcm9jZXNzQWRkcmVzc0NvbXBvbmVudHMiLCJzZXRDb250ZW50Iiwib3BlbiIsInNldFBvc2l0aW9uIiwic2V0VmlzaWJsZSIsImZpbHRlciIsImFkZHJlc3NfY29tcG9uZW50cyIsInR5cGVzIiwibG9uZ19uYW1lIiwiY2xlYXJMaXN0ZW5lcnMiLCJtYXJrZXJCb3VuZHMiLCJMYXRMbmdCb3VuZHMiLCJpbWFnZVVybCIsIm1hcmtlckltYWdlIiwiTWFya2VySW1hZ2UiLCJTaXplIiwiZ29vZ2xlTWFya2VyIiwiaWNvbiIsInRpdGxlIiwic2V0Wm9vbSIsInNldENlbnRlciIsImdldFBvc2l0aW9uIiwiY29uc29sZSIsImxvZyIsImV4dGVuZCIsIm1jT3B0aW9ucyIsImdyaWRTaXplIiwibWF4Wm9vbSIsInN0eWxlcyIsInVybCIsImhlaWdodCIsIndpZHRoIiwiYW5jaG9yIiwidGV4dENvbG9yIiwidGV4dFNpemUiLCJtYXJrZXJDbHVzdGVyZXIiLCJNYXJrZXJDbHVzdGVyZXIiLCJyZWRyYXciLCJ0b2dnbGVGcmVlemVkIiwiJGJyb2FkY2FzdCIsImRpcmVjdGl2ZSIsInJlc3RyaWN0IiwiZnJlZXplQnV0dG9uIiwicmVwbGFjZSIsInRlbXBsYXRlVXJsIiwiJGluamVjdCIsIiRodHRwIiwiZ29vZ2xlR2VvY29kZVNlcnZpY2VVUkwiLCJnZXQiLCJyZXNwb25zZSIsImRhdGEiLCJyZXN1bHRzIiwic2VydmljZSIsImZhY3RvcnkiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsWUFFQUEsU0FBQUMsT0FBQSx3QkNIQSxTQUFBQSxHQUNBLElBQ0FBLEVBQUFELFFBQUFDLE9BQUEsa0JBQ0EsTUFBQUMsR0FDQUQsRUFBQUQsUUFBQUMsT0FBQSxxQkFFQUEsRUFBQUUsS0FBQSxpQkFBQSxTQUFBQyxHQUNBQSxFQUFBQyxJQUFBLGVBQ0Esc2hCQ1JBLFdBQ0EsWUFNQSxTQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQXVCQSxRQUFBQyxHQUFBQyxHQWlCQSxRQUFBQyxLQUNBQyxJQUNBQyxFQUFBQyxZQUNBQyx3QkFBQSxFQUNBQyxXQUFBLEVBQ0FDLGFBQUEsSUFJQSxRQUFBQyxLQUNBQyxJQUNBTixFQUFBQyxZQUNBQyx3QkFBQSxFQUNBQyxXQUFBLEVBQ0FDLGFBQUEsSUFnQkEsUUFBQUcsS0FDQSxHQUFBQyxHQUFBZixFQUFBZ0IsUUFDQUMsR0FBQSxlQUFBLHFCQUFBLG9CQUNBQyxFQUFBLDJDQUFBRCxFQUFBRSxLQUFBLEtBQ0FDLEVBQUFDLFNBQUFDLGNBQUEsU0FJQSxPQUhBRixHQUFBRyxLQUFBLGtCQUNBSCxFQUFBSSxJQUFBTixFQUVBaEIsRUFBQXVCLFdBQ0FyQixFQUFBc0IsSUFBQSx3QkFBQUMsR0FDQVosRUFBQWEsU0FFQWIsRUFBQWMsVUFHQVIsU0FBQVMsS0FBQUMsWUFBQVgsR0FDQWxCLEVBQUF1QixXQUFBLEVBRUExQixFQUFBaUMsVUFBQSxXQUNBakIsRUFBQWtCLFdBR0FsQixFQUFBYyxTQUlBLFFB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Z0YsR0FYQWxLLFFBQ0FDLE9BQUEsa0JBQ0FrSyxRQUFBLHNCQUFBekosR0EyQkFBLEVBQUFpSixTQUFBIiwiZmlsZSI6ImxhenlHb29nbGVNYXBzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2xhenlHb29nbGVNYXBzJywgW10pO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKG1vZHVsZSkge1xudHJ5IHtcbiAgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2xhenlHb29nbGVNYXBzJyk7XG59IGNhdGNoIChlKSB7XG4gIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdsYXp5R29vZ2xlTWFwcycsIFtdKTtcbn1cbm1vZHVsZS5ydW4oWyckdGVtcGxhdGVDYWNoZScsIGZ1bmN0aW9uKCR0ZW1wbGF0ZUNhY2hlKSB7XG4gICR0ZW1wbGF0ZUNhY2hlLnB1dCgnbWFwL21hcC5odG1sJyxcbiAgICAnPGRpdiBjbGFzcz1cImxhenktZ29vZ2xlLW1hcHNcIj48aW5wdXQgaWQ9XCJsYXp5LWdvb2dsZS1tYXBzLXNlYXJjaC17eyRpZH19XCIgbmctaGlkZT1cImN1c3RvbVNlYXJjaEVsZW1lbnRJZFwiIGNsYXNzPVwibGF6eS1nb29nbGUtbWFwcy1zZWFyY2hcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiU2VhcmNoIGZvciBhIHBsYWNlLi4uXCI+IDxidXR0b24gbmctaWY9XCJmcmVlemVCdXR0b25cIiBuZy1kaXNhYmxlZD1cImlzTG9hZGluZ1wiIG5nLWNsYXNzPVwieyBcXCdmcmVlemVkXFwnOiBmcmVlemVkIH1cIiBuZy1jbGljaz1cInRvZ2dsZUZyZWV6ZWQoKVwiIGlkPVwiYnV0dG9uLXt7ICRpZCB9fVwiIGNsYXNzPVwicmFuZG9tLWJ1dHRvbi1lbGVtZW50XCI+PHNwYW4gbmctaWY9XCIhZnJlZXplZFwiPkZyZWV6ZTwvc3Bhbj4gPHNwYW4gbmctaWY9XCJmcmVlemVkXCI+VW5mcmVlemU8L3NwYW4+PC9idXR0b24+PGRpdiBpZD1cImxhenktZ29vZ2xlLW1hcHMtY2FudmFzLXt7JGlkfX1cIiBjbGFzcz1cImxhenktZ29vZ2xlLW1hcHMtY2FudmFzXCI+PC9kaXY+PC9kaXY+Jyk7XG59XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbGF6eUdvb2dsZU1hcHMnKVxuICAgICAgICAuZGlyZWN0aXZlKCdsYXp5R29vZ2xlTWFwcycsIGxhenlHb29nbGVNYXBzKTtcblxuICAgIGZ1bmN0aW9uIGxhenlHb29nbGVNYXBzICgkd2luZG93LCAkcSwgJHJvb3RTY29wZSwgbGF6eUdvb2dsZU1hcHNVdGlscykge1xuICAgICAgICB2YXIgXyA9ICR3aW5kb3cuXztcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGxhdDogJz0/JyxcbiAgICAgICAgICAgICAgICBsbmc6ICc9PycsXG4gICAgICAgICAgICAgICAgY291bnRyeTogJz0/JyxcbiAgICAgICAgICAgICAgICBjaXR5OiAnPT8nLFxuICAgICAgICAgICAgICAgIHBsYWNlOiAnPT8nLFxuICAgICAgICAgICAgICAgIGN1c3RvbVNlYXJjaEVsZW1lbnRJZDogJz0/JyxcbiAgICAgICAgICAgICAgICBmcmVlemVCdXR0b246ICc9PycsXG4gICAgICAgICAgICAgICAgZnJlZXplZDogJz0/JyxcbiAgICAgICAgICAgICAgICBpc0xvYWRpbmc6ICdAJyxcbiAgICAgICAgICAgICAgICBtYXJrZXJzOiAnPT8nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbWFwL21hcC5odG1sJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUpIHtcbiAgICAgICAgICAgIHZhciBtYXBzO1xuICAgICAgICAgICAgdmFyIHJlbmRlcmVkTWFwO1xuICAgICAgICAgICAgdmFyIG1hcmtlcjtcbiAgICAgICAgICAgIHZhciBpbmZvd2luZG93O1xuICAgICAgICAgICAgdmFyIHNlYXJjaElucHV0RWxlbWVudDtcbiAgICAgICAgICAgIHZhciBtYXJrZXJDbHVzdGVyZXI7XG5cbiAgICAgICAgICAgIHNjb3BlLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIHNjb3BlLnRvZ2dsZUZyZWV6ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuZnJlZXplZCA9ICFzY29wZS5mcmVlemVkO1xuICAgICAgICAgICAgICAgIGlmIChzY29wZS5mcmVlemVkKSB7IHJldHVybiBmcmVlemUoKTsgfVxuICAgICAgICAgICAgICAgIHVuRnJlZXplKCk7XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZyZWV6ZSgpIHtcbiAgICAgICAgICAgICAgICByZW1vdmVDbGlja0xpc3RlbmVyKCk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZWRNYXAuc2V0T3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVEb3VibGVDbGlja1pvb206IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gdW5GcmVlemUoKSB7XG4gICAgICAgICAgICAgICAgYWRkQ2xpY2tMaXN0ZW5lcigpO1xuICAgICAgICAgICAgICAgIHJlbmRlcmVkTWFwLnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlRG91YmxlQ2xpY2tab29tOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNjcm9sbHdoZWVsOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgaWYgKG1hcHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyTWFwKCk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgaW5qZWN0TWFwKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsYXp5R29vZ2xlTWFwczpsb2FkZWQnKTtcbiAgICAgICAgICAgICAgICByZW5kZXJNYXAoKTtcbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGluamVjdE1hcCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gWydzZW5zb3I9ZmFsc2UnLCAnY2FsbGJhY2s9bWFwTG9hZGVkJywgJ2xpYnJhcmllcz1wbGFjZXMnXTtcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9qcz8nICsgb3B0aW9ucy5qb2luKCcmJyk7XG4gICAgICAgICAgICAgICAgdmFyIHNjcmlwdFRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICAgICAgICAgIHNjcmlwdFRhZy50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICAgICAgICAgICAgc2NyaXB0VGFnLnNyYyA9IHNvdXJjZTtcblxuICAgICAgICAgICAgICAgIGlmIChsYXp5R29vZ2xlTWFwc1V0aWxzLmlzTG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kb24oJ2xhenlHb29nbGVNYXBzOmxvYWRlZCcsIHJlbmRlck1hcCk7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0VGFnKTtcbiAgICAgICAgICAgICAgICBsYXp5R29vZ2xlTWFwc1V0aWxzLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAkd2luZG93Lm1hcExvYWRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiByZW5kZXJNYXAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1hcE9wdGlvbnM7XG4gICAgICAgICAgICAgICAgdmFyIHdhdGNoTGF0TG5nO1xuICAgICAgICAgICAgICAgIG1hcHMgPSBnb29nbGUubWFwcztcbiAgICAgICAgICAgICAgICBtYXBPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICB6b29tOiA4LFxuICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoLTMzLjg2ODAwMSwgMTUxLjE5NTI0OCksXG4gICAgICAgICAgICAgICAgICAgIHBhbkNvbnRyb2xPcHRpb25zOiB7IHBvc2l0aW9uOiBtYXBzLkNvbnRyb2xQb3NpdGlvbi5MRUZUX0NFTlRFUiB9LFxuICAgICAgICAgICAgICAgICAgICB6b29tQ29udHJvbE9wdGlvbnM6IHsgcG9zaXRpb246IG1hcHMuQ29udHJvbFBvc2l0aW9uLkxFRlRfQ0VOVEVSIH0sXG4gICAgICAgICAgICAgICAgICAgIHN0cmVldFZpZXdDb250cm9sT3B0aW9uczogeyBwb3NpdGlvbjogbWFwcy5Db250cm9sUG9zaXRpb24uTEVGVF9DRU5URVIgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmVuZGVyZWRNYXAgPSBuZXcgbWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhenktZ29vZ2xlLW1hcHMtY2FudmFzLScgKyBzY29wZS4kaWQpLCBtYXBPcHRpb25zKTtcbiAgICAgICAgICAgICAgICBtYXJrZXIgPSBuZXcgbWFwcy5NYXJrZXIoeyBtYXA6IHJlbmRlcmVkTWFwIH0pO1xuICAgICAgICAgICAgICAgIGluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdygpO1xuXG4gICAgICAgICAgICAgICAgcmVuZGVyUGxhY2VTZWFyY2goKTtcbiAgICAgICAgICAgICAgICBhZGRDbGlja0xpc3RlbmVyKCk7XG5cblxuICAgICAgICAgICAgICAgIHNjb3BlLmlzTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZyZWV6ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZnJlZXplKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLm1hcmtlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNldE1hcmtlckNsdXN0ZXIoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3YXRjaExhdExuZyA9IHNjb3BlLiR3YXRjaEdyb3VwKFsnbGF0JywgJ2xuZyddLCBmdW5jdGlvbiAoY29vcmRpbmF0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdhdGNoQWRkcmVzcztcbiAgICAgICAgICAgICAgICAgICAgaWYoY29vcmRpbmF0ZXNbMF0gJiYgY29vcmRpbmF0ZXNbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlTWFya2VyQnlMYXRMbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3YXRjaExhdExuZygpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgd2F0Y2hBZGRyZXNzID0gc2NvcGUuJHdhdGNoR3JvdXAoWydjaXR5JywgJ2NvdW50cnknLCAncGxhY2UnXSwgZnVuY3Rpb24gKGFkZHJlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZGRyZXNzWzBdIHx8IGFkZHJlc3NbMV0gfHwgYWRkcmVzc1syXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhdGNoTGF0TG5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VNYXJrZXJCeUFkZHJlc3MoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2F0Y2hBZGRyZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHBsYWNlTWFya2VyQnlMYXRMbmcoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhdExuZyA9IHNjb3BlLmxhdCArICcsJyArIHNjb3BlLmxuZztcblxuICAgICAgICAgICAgICAgIGxhenlHb29nbGVNYXBzVXRpbHMucmV2ZXJzZUdlb2NvZGUobGF0TG5nKS50aGVuKGZ1bmN0aW9uIChwbGFjZSkge1xuICAgICAgICAgICAgICAgICAgICBpZihwbGFjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1BsYWNlKHBsYWNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwbGFjZU1hcmtlckJ5QWRkcmVzcygpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWRkcmVzcyA9IChzY29wZS5jaXR5IHx8ICcnKSArICcgJyArIChzY29wZS5jb3VudHJ5IHx8ICcnKSArICcgJyArIChzY29wZS5wbGFjZSB8fCAnJyk7XG5cbiAgICAgICAgICAgICAgICBsYXp5R29vZ2xlTWFwc1V0aWxzLmdlb2NvZGUoYWRkcmVzcykudGhlbihmdW5jdGlvbiAocGxhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocGxhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NQbGFjZShwbGFjZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiByZW5kZXJQbGFjZVNlYXJjaCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoQm94O1xuICAgICAgICAgICAgICAgIHNlYXJjaElucHV0RWxlbWVudCA9IGdldFNlYXJjaElucHV0KCk7XG4gICAgICAgICAgICAgICAgc2VhcmNoQm94ID0gbmV3IGdvb2dsZS5tYXBzLnBsYWNlcy5TZWFyY2hCb3goKHNlYXJjaElucHV0RWxlbWVudCkpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFzY29wZS5jdXN0b21TZWFyY2hFbGVtZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWRNYXAuY29udHJvbHNbbWFwcy5Db250cm9sUG9zaXRpb24uVE9QX0xFRlRdLnB1c2goc2VhcmNoSW5wdXRFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBtYXBzLmV2ZW50LmFkZExpc3RlbmVyKHNlYXJjaEJveCwgJ3BsYWNlc19jaGFuZ2VkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwbGFjZSA9IHNlYXJjaEJveC5nZXRQbGFjZXMoKVswXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXBsYWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzUGxhY2UocGxhY2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2VhcmNoSW5wdXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5jdXN0b21TZWFyY2hFbGVtZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzY29wZS5jdXN0b21TZWFyY2hFbGVtZW50SWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGF6eS1nb29nbGUtbWFwcy1zZWFyY2gtJyArIHNjb3BlLiRpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGFkZENsaWNrTGlzdGVuZXIoKSB7XG4gICAgICAgICAgICAgICAgbWFwcy5ldmVudC5hZGRMaXN0ZW5lcihyZW5kZXJlZE1hcCwgJ2NsaWNrJywgZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXRMbmcgPSB0YXJnZXQubGF0TG5nLkEgKyAnLCcgKyB0YXJnZXQubGF0TG5nLkY7XG5cbiAgICAgICAgICAgICAgICAgICAgbGF6eUdvb2dsZU1hcHNVdGlscy5yZXZlcnNlR2VvY29kZShsYXRMbmcpLnRoZW4oZnVuY3Rpb24gKHBsYWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihwbGFjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NQbGFjZShwbGFjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NQbGFjZShwbGFjZSkge1xuICAgICAgICAgICAgICAgIHZhciBpbmZvV2luZG93Q29udGVudDtcblxuICAgICAgICAgICAgICAgIGluZm93aW5kb3cuY2xvc2UoKTtcblxuICAgICAgICAgICAgICAgIGlmIChfLmhhcyhwbGFjZSwgJ2dlb21ldHJ5LnZpZXdwb3J0LkRhJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWRNYXAuZml0Qm91bmRzKHBsYWNlLmdlb21ldHJ5LnZpZXdwb3J0KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZW5kZXJlZE1hcC5wYW5UbyhwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbik7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUubWFya2Vycykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2V0TWFya2VyKHBsYWNlKTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLnBsYWNlID0gcGxhY2UuZm9ybWF0dGVkX2FkZHJlc3M7XG4gICAgICAgICAgICAgICAgc2NvcGUubGF0ID0gcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24uQSB8fCBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sYXQ7XG4gICAgICAgICAgICAgICAgc2NvcGUubG5nID0gcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24uRiB8fCBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sbmc7XG5cbiAgICAgICAgICAgICAgICBzZWFyY2hJbnB1dEVsZW1lbnQudmFsdWUgPSBzY29wZS5wbGFjZTtcblxuICAgICAgICAgICAgICAgIHByb2Nlc3NBZGRyZXNzQ29tcG9uZW50cyhwbGFjZSk7XG5cbiAgICAgICAgICAgICAgICBpbmZvV2luZG93Q29udGVudCA9ICc8ZGl2PjxzdHJvbmc+JyArIHNjb3BlLmNpdHkgKyAnPC9zdHJvbmc+PGJyPicgKyBzY29wZS5wbGFjZSArICc8L2Rpdj4nO1xuICAgICAgICAgICAgICAgIGluZm93aW5kb3cuc2V0Q29udGVudChpbmZvV2luZG93Q29udGVudCk7XG4gICAgICAgICAgICAgICAgaW5mb3dpbmRvdy5vcGVuKHJlbmRlcmVkTWFwLCBtYXJrZXIpO1xuXG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0TWFya2VyKHBsYWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gcGxhY2UuZ2VvbWV0cnkubG9jYXRpb247XG4gICAgICAgICAgICAgICAgbWFya2VyLnNldFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBtYXJrZXIuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzQWRkcmVzc0NvbXBvbmVudHMocGxhY2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IF8uZmlsdGVyKHBsYWNlLmFkZHJlc3NfY29tcG9uZW50cywgeyB0eXBlczogWydjb3VudHJ5J10gfSk7XG4gICAgICAgICAgICAgICAgdmFyIGNpdHkgPSBfLmZpbHRlcihwbGFjZS5hZGRyZXNzX2NvbXBvbmVudHMsIHsgdHlwZXM6IFsnbG9jYWxpdHknXSB9KTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLmNvdW50cnkgPSBjb3VudHJ5WzBdID8gY291bnRyeVswXS5sb25nX25hbWUgOiBzY29wZS5wbGFjZTtcbiAgICAgICAgICAgICAgICBzY29wZS5jaXR5ID0gY2l0eVswXSA/IGNpdHlbMF0ubG9uZ19uYW1lIDogc2NvcGUuY291bnRyeTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiByZW1vdmVDbGlja0xpc3RlbmVyKCkge1xuICAgICAgICAgICAgICAgIG1hcHMuZXZlbnQuY2xlYXJMaXN0ZW5lcnMocmVuZGVyZWRNYXAsICdjbGljaycpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldE1hcmtlckNsdXN0ZXIoKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgbWFya2VyQm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xuICAgICAgICAgICAgICAgIHZhciBpbWFnZVVybCA9ICdodHRwOi8vY2hhcnQuYXBpcy5nb29nbGUuY29tL2NoYXJ0P2NodD1tbSZjaHM9MjR4MzImY2hjbz1GRkZGRkYsMDA4Q0ZGLDAwMDAwMCZleHQ9LnBuZyc7XG4gICAgICAgICAgICAgICAgdmFyIG1hcmtlckltYWdlID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlckltYWdlKGltYWdlVXJsLCBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgyNCwgMzIpKTtcblxuXG4gICAgICAgICAgICAgICAgdmFyIG1hcmtlcnMgPSBfLm1hcChzY29wZS5tYXJrZXJzLCBmdW5jdGlvbiAocG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhdExuZyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocG9zaXRpb24ubGF0LCBwb3NpdGlvbi5sbmcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBnb29nbGVNYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBsYXRMbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uOiBtYXJrZXJJbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnQ2xpY2sgdG8gem9vbSdcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgbWFwcy5ldmVudC5hZGRMaXN0ZW5lcihnb29nbGVNYXJrZXIsICdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWRNYXAuc2V0Wm9vbSgxNyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlZE1hcC5zZXRDZW50ZXIoZ29vZ2xlTWFya2VyLmdldFBvc2l0aW9uKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZ29vZ2xlTWFya2VyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgbWFya2VyQm91bmRzLmV4dGVuZChsYXRMbmcpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ29vZ2xlTWFya2VyO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIG1jT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZFNpemU6IDkwLFxuICAgICAgICAgICAgICAgICAgICBtYXhab29tOiAxNSxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBpbWFnZVVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMzUsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMzUsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IFsxNiwgMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0Q29sb3I6ICcjZmYwMGZmJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRTaXplOiAxMFxuICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgbWFya2VyQ2x1c3RlcmVyID0gbmV3IE1hcmtlckNsdXN0ZXJlcihyZW5kZXJlZE1hcCwgbWFya2VycywgbWNPcHRpb25zKTtcbiAgICAgICAgICAgICAgICByZW5kZXJlZE1hcC5maXRCb3VuZHMobWFya2VyQm91bmRzKTtcblxuICAgICAgICAgICAgICAgIG1hcmtlckNsdXN0ZXJlci5yZWRyYXcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBsYXp5R29vZ2xlTWFwcy4kaW5qZWN0ID0gW1wiJHdpbmRvd1wiLCBcIiRxXCIsIFwiJHJvb3RTY29wZVwiLCBcImxhenlHb29nbGVNYXBzVXRpbHNcIl07XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2xhenlHb29nbGVNYXBzJylcbiAgICAgICAgLmZhY3RvcnkoJ2xhenlHb29nbGVNYXBzVXRpbHMnLCBsYXp5R29vZ2xlTWFwc1V0aWxzKTtcblxuICAgIGZ1bmN0aW9uIGxhenlHb29nbGVNYXBzVXRpbHMoJGh0dHApIHtcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgcmV2ZXJzZUdlb2NvZGU6IHJldmVyc2VHZW9jb2RlLFxuICAgICAgICAgICAgZ2VvY29kZTogZ2VvY29kZVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIGZ1bmN0aW9uIHJldmVyc2VHZW9jb2RlKGxhdExuZykge1xuICAgICAgICAgICAgdmFyIGdvb2dsZUdlb2NvZGVTZXJ2aWNlVVJMID0gJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24/bGF0bG5nPSc7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KGdvb2dsZUdlb2NvZGVTZXJ2aWNlVVJMICsgbGF0TG5nKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLnJlc3VsdHNbMF07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgZnVuY3Rpb24gZ2VvY29kZShhZGRyZXNzKSB7XG4gICAgICAgICAgICB2YXIgZ29vZ2xlR2VvY29kZVNlcnZpY2VVUkwgPSAnaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbj9hZGRyZXNzPSc7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KGdvb2dsZUdlb2NvZGVTZXJ2aWNlVVJMICsgYWRkcmVzcykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5yZXN1bHRzWzBdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH1cbiAgICBsYXp5R29vZ2xlTWFwc1V0aWxzLiRpbmplY3QgPSBbXCIkaHR0cFwiXTtcbn0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=