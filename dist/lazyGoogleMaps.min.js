!function(){"use strict";angular.module("lazyGoogleMaps",[])}(),function(e){try{e=angular.module("lazyGoogleMaps")}catch(o){e=angular.module("lazyGoogleMaps",[])}e.run(["$templateCache",function(e){e.put("map/map.html",'<div class="lazy-google-maps"><input id="lazy-google-maps-search-{{$id}}" class="lazy-google-maps-search" type="text" placeholder="Search for a place..."><div id="lazy-google-maps-canvas-{{$id}}" class="lazy-google-maps-canvas"></div></div>')}])}(),function(){"use strict";function e(e,o,t,a){function n(n){function l(){var t=o.defer(),c=["sensor=false","callback=mapLoaded","libraries=places"],l="https://maps.googleapis.com/maps/api/js?"+c.join("&"),i=document.createElement("script");return i.type="text/javascript",i.src=l,a.isLoading?(n.$on("lazyGoogleMaps:loaded",r),t.reject(),t.promise):(document.body.appendChild(i),a.isLoading=!0,e.mapLoaded=function(){t.resolve()},t.promise)}function r(){var e,o;y=google.maps,e={zoom:8},f=new y.Map(document.getElementById("lazy-google-maps-canvas-"+n.$id),e),v=new y.Marker({map:f}),h=new google.maps.InfoWindow,p(),g(),o=n.$watchGroup(["lat","lng"],function(e){var t;return e[0]&&e[0]?(i(),o()):void(t=n.$watchGroup(["city","country","place"],function(e){return e[0]||e[1]||e[2]?(o(),s(),t()):void 0}))})}function i(){var e=n.lat+","+n.lng;a.reverseGeocode(e).then(function(e){e&&u(e)})}function s(){var e=(n.city||"")+" "+(n.country||"")+" "+(n.place||"");a.geocode(e).then(function(e){e&&u(e)})}function p(){var e=document.getElementById("lazy-google-maps-search-"+n.$id),o=new google.maps.places.SearchBox(e);f.controls[y.ControlPosition.TOP_LEFT].push(e),y.event.addListener(o,"places_changed",function(){var e=o.getPlaces()[0];e&&u(e)})}function g(){y.event.addListener(f,"click",function(e){var o=e.latLng.A+","+e.latLng.F;a.reverseGeocode(o).then(function(e){e&&u(e)})})}function u(e){var o,t=new y.LatLngBounds;d(e),h.close(),c.has(e,"geometry.viewport.Da")?f.fitBounds(e.geometry.viewport):c.has(e,"geometry.location.A")&&(t.extend(e.geometry.location),f.fitBounds(t)),f.panTo(e.geometry.location),n.place=e.formatted_address,n.lat=e.geometry.location.A||e.geometry.location.lat,n.lng=e.geometry.location.F||e.geometry.location.lng,m(e),o="<div><strong>"+n.city+"</strong><br>"+n.place+"</div>",h.setContent(o),h.open(f,v)}function d(e){var o={url:e.icon,size:new y.Size(71,71),origin:new y.Point(0,0),anchor:new y.Point(17,34),scaledSize:new y.Size(35,35)},t=e.geometry.location;e.icon&&v.setIcon(o),v.setPosition(t),v.setVisible(!0)}function m(e){var o=c.filter(e.address_components,{types:["country"]}),t=c.filter(e.address_components,{types:["locality"]});n.country=o[0]?o[0].long_name:n.place,n.city=t[0]?t[0].long_name:n.country}var y,f,v,h;return y?r():void l().then(function(){t.$broadcast("lazyGoogleMaps:loaded"),r()})}var c=e._,l={restrict:"E",scope:{lat:"=?",lng:"=?",country:"=?",city:"=?",place:"=?"},replace:!0,templateUrl:"map/map.html",link:n};return l}angular.module("lazyGoogleMaps").directive("lazyGoogleMaps",e),e.$inject=["$window","$q","$rootScope","lazyGoogleMapsUtils"]}(),function(){"use strict";function e(e){function o(o){var t="https://maps.googleapis.com/maps/api/geocode/json?latlng=";return e.get(t+o).then(function(e){return e.data.results[0]})}function t(o){var t="https://maps.googleapis.com/maps/api/geocode/json?address=";return e.get(t+o).then(function(e){return e.data.results[0]})}var a={isLoading:!1,reverseGeocode:o,geocode:t};return a}angular.module("lazyGoogleMaps").factory("lazyGoogleMapsUtils",e),e.$inject=["$http"]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1hcC9tYXAuanMiLCJtYXAvbWFwLmRpcmVjdGl2ZS5qcyIsIm1hcC9tYXAuc2VydmljZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZSIsInJ1biIsIiR0ZW1wbGF0ZUNhY2hlIiwicHV0IiwibGF6eUdvb2dsZU1hcHMiLCIkd2luZG93IiwiJHEiLCIkcm9vdFNjb3BlIiwibGF6eUdvb2dsZU1hcHNVdGlscyIsImxpbmsiLCJzY29wZSIsImluamVjdE1hcCIsImRlZmVycmVkIiwiZGVmZXIiLCJvcHRpb25zIiwic291cmNlIiwiam9pbiIsInNjcmlwdFRhZyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInR5cGUiLCJzcmMiLCJpc0xvYWRpbmciLCIkb24iLCJyZW5kZXJNYXAiLCJyZWplY3QiLCJwcm9taXNlIiwiYm9keSIsImFwcGVuZENoaWxkIiwibWFwTG9hZGVkIiwicmVzb2x2ZSIsIm1hcE9wdGlvbnMiLCJ3YXRjaExhdExuZyIsIm1hcHMiLCJnb29nbGUiLCJ6b29tIiwicmVuZGVyZWRNYXAiLCJNYXAiLCJnZXRFbGVtZW50QnlJZCIsIiRpZCIsIm1hcmtlciIsIk1hcmtlciIsIm1hcCIsImluZm93aW5kb3ciLCJJbmZvV2luZG93IiwicmVuZGVyUGxhY2VTZWFyY2giLCJhZGRDbGlja0xpc3RlbmVyIiwiJHdhdGNoR3JvdXAiLCJjb29yZGluYXRlcyIsIndhdGNoQWRkcmVzcyIsInBsYWNlTWFya2VyQnlMYXRMbmciLCJhZGRyZXNzIiwicGxhY2VNYXJrZXJCeUFkZHJlc3MiLCJsYXRMbmciLCJsYXQiLCJsbmciLCJyZXZlcnNlR2VvY29kZSIsInRoZW4iLCJwbGFjZSIsInByb2Nlc3NQbGFjZSIsImNpdHkiLCJjb3VudHJ5IiwiZ2VvY29kZSIsInNlYXJjaElucHV0Iiwic2VhcmNoQm94IiwicGxhY2VzIiwiU2VhcmNoQm94IiwiY29udHJvbHMiLCJDb250cm9sUG9zaXRpb24iLCJUT1BfTEVGVCIsInB1c2giLCJldmVudCIsImFkZExpc3RlbmVyIiwiZ2V0UGxhY2VzIiwidGFyZ2V0IiwiQSIsIkYiLCJpbmZvV2luZG93Q29udGVudCIsImJvdW5kcyIsIkxhdExuZ0JvdW5kcyIsInNldE1hcmtlciIsImNsb3NlIiwiXyIsImhhcyIsImZpdEJvdW5kcyIsImdlb21ldHJ5Iiwidmlld3BvcnQiLCJleHRlbmQiLCJsb2NhdGlvbiIsInBhblRvIiwiZm9ybWF0dGVkX2FkZHJlc3MiLCJwcm9jZXNzQWRkcmVzc0NvbXBvbmVudHMiLCJzZXRDb250ZW50Iiwib3BlbiIsIm1hcmtlckltYWdlIiwidXJsIiwiaWNvbiIsInNpemUiLCJTaXplIiwib3JpZ2luIiwiUG9pbnQiLCJhbmNob3IiLCJzY2FsZWRTaXplIiwicG9zaXRpb24iLCJzZXRJY29uIiwic2V0UG9zaXRpb24iLCJzZXRWaXNpYmxlIiwiZmlsdGVyIiwiYWRkcmVzc19jb21wb25lbnRzIiwidHlwZXMiLCJsb25nX25hbWUiLCIkYnJvYWRjYXN0IiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJyZXBsYWNlIiwidGVtcGxhdGVVcmwiLCIkaW5qZWN0IiwiJGh0dHAiLCJnb29nbGVHZW9jb2RlU2VydmljZVVSTCIsImdldCIsInJlc3BvbnNlIiwiZGF0YSIsInJlc3VsdHMiLCJzZXJ2aWNlIiwiZmFjdG9yeSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQUVBQSxTQUFBQyxPQUFBLHdCQ0hBLFNBQUFBLEdBQ0EsSUFDQUEsRUFBQUQsUUFBQUMsT0FBQSxrQkFDQSxNQUFBQyxHQUNBRCxFQUFBRCxRQUFBQyxPQUFBLHFCQUVBQSxFQUFBRSxLQUFBLGlCQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLElBQUEsZUFDQSwwUENSQSxXQUNBLFlBTUEsU0FBQUMsR0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FrQkEsUUFBQUMsR0FBQUMsR0FnQkEsUUFBQUMsS0FDQSxHQUFBQyxHQUFBTixFQUFBTyxRQUNBQyxHQUFBLGVBQUEscUJBQUEsb0JBQ0FDLEVBQUEsMkNBQUFE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QWlFLEdBQUEsMkRBQ0EsT0FBQUQsR0FBQUUsSUFBQUQsRUFBQWpFLEdBQUFJLEtBQUEsU0FBQStELEdBQ0EsTUFBQUEsR0FBQUMsS0FBQUMsUUFBQSxLQUtBLFFBQUE1RCxHQUFBWCxHQUNBLEdBQUFtRSxHQUFBLDREQUNBLE9BQUFELEdBQUFFLElBQUFELEVBQUFuRSxHQUFBTSxLQUFBLFNBQUErRCxHQUNBLE1BQUFBLEdBQUFDLEtBQUFDLFFBQUEsS0FuQkEsR0FBQUMsSUFDQXJHLFdBQUEsRUFDQWtDLGVBQUFBLEVBQ0FNLFFBQUFBLEVBR0EsT0FBQTZELEdBWEE3SCxRQUNBQyxPQUFBLGtCQUNBNkgsUUFBQSxzQkFBQXBILEdBMkJBQSxFQUFBNEcsU0FBQSIsImZpbGUiOiJsYXp5R29vZ2xlTWFwcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdsYXp5R29vZ2xlTWFwcycsIFtdKTtcblxufSkoKTtcbiIsIihmdW5jdGlvbihtb2R1bGUpIHtcbnRyeSB7XG4gIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdsYXp5R29vZ2xlTWFwcycpO1xufSBjYXRjaCAoZSkge1xuICBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnbGF6eUdvb2dsZU1hcHMnLCBbXSk7XG59XG5tb2R1bGUucnVuKFsnJHRlbXBsYXRlQ2FjaGUnLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkge1xuICAkdGVtcGxhdGVDYWNoZS5wdXQoJ21hcC9tYXAuaHRtbCcsXG4gICAgJzxkaXYgY2xhc3M9XCJsYXp5LWdvb2dsZS1tYXBzXCI+PGlucHV0IGlkPVwibGF6eS1nb29nbGUtbWFwcy1zZWFyY2gte3skaWR9fVwiIGNsYXNzPVwibGF6eS1nb29nbGUtbWFwcy1zZWFyY2hcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiU2VhcmNoIGZvciBhIHBsYWNlLi4uXCI+PGRpdiBpZD1cImxhenktZ29vZ2xlLW1hcHMtY2FudmFzLXt7JGlkfX1cIiBjbGFzcz1cImxhenktZ29vZ2xlLW1hcHMtY2FudmFzXCI+PC9kaXY+PC9kaXY+Jyk7XG59XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdsYXp5R29vZ2xlTWFwcycpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnbGF6eUdvb2dsZU1hcHMnLCBsYXp5R29vZ2xlTWFwcyk7XHJcblxyXG4gICAgZnVuY3Rpb24gbGF6eUdvb2dsZU1hcHMgKCR3aW5kb3csICRxLCAkcm9vdFNjb3BlLCBsYXp5R29vZ2xlTWFwc1V0aWxzKSB7XHJcbiAgICAgICAgdmFyIF8gPSAkd2luZG93Ll87XHJcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGxhdDogJz0/JyxcclxuICAgICAgICAgICAgICAgIGxuZzogJz0/JyxcclxuICAgICAgICAgICAgICAgIGNvdW50cnk6ICc9PycsXHJcbiAgICAgICAgICAgICAgICBjaXR5OiAnPT8nLFxyXG4gICAgICAgICAgICAgICAgcGxhY2U6ICc9PydcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtYXAvbWFwLmh0bWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSkge1xyXG4gICAgICAgICAgICB2YXIgbWFwcztcclxuICAgICAgICAgICAgdmFyIHJlbmRlcmVkTWFwO1xyXG4gICAgICAgICAgICB2YXIgbWFya2VyO1xyXG4gICAgICAgICAgICB2YXIgaW5mb3dpbmRvdztcclxuXHJcbiAgICAgICAgICAgIGlmIChtYXBzKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyTWFwKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGluamVjdE1hcCgpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsYXp5R29vZ2xlTWFwczpsb2FkZWQnKTtcclxuICAgICAgICAgICAgICAgIHJlbmRlck1hcCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpbmplY3RNYXAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBbJ3NlbnNvcj1mYWxzZScsICdjYWxsYmFjaz1tYXBMb2FkZWQnLCAnbGlicmFyaWVzPXBsYWNlcyddO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/JyArIG9wdGlvbnMuam9pbignJicpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNjcmlwdFRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xyXG4gICAgICAgICAgICAgICAgc2NyaXB0VGFnLnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JztcclxuICAgICAgICAgICAgICAgIHNjcmlwdFRhZy5zcmMgPSBzb3VyY2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGxhenlHb29nbGVNYXBzVXRpbHMuaXNMb2FkaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJG9uKCdsYXp5R29vZ2xlTWFwczpsb2FkZWQnLCByZW5kZXJNYXApO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdFRhZyk7XHJcbiAgICAgICAgICAgICAgICBsYXp5R29vZ2xlTWFwc1V0aWxzLmlzTG9hZGluZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgJHdpbmRvdy5tYXBMb2FkZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlck1hcCgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtYXBPcHRpb25zO1xyXG4gICAgICAgICAgICAgICAgdmFyIHdhdGNoTGF0TG5nO1xyXG4gICAgICAgICAgICAgICAgbWFwcyA9IGdvb2dsZS5tYXBzO1xyXG4gICAgICAgICAgICAgICAgbWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICB6b29tOiA4XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcmVuZGVyZWRNYXAgPSBuZXcgbWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhenktZ29vZ2xlLW1hcHMtY2FudmFzLScgKyBzY29wZS4kaWQpLCBtYXBPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIG1hcmtlciA9IG5ldyBtYXBzLk1hcmtlcih7IG1hcDogcmVuZGVyZWRNYXAgfSk7XHJcbiAgICAgICAgICAgICAgICBpbmZvd2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZW5kZXJQbGFjZVNlYXJjaCgpO1xyXG4gICAgICAgICAgICAgICAgYWRkQ2xpY2tMaXN0ZW5lcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHdhdGNoTGF0TG5nID0gc2NvcGUuJHdhdGNoR3JvdXAoWydsYXQnLCAnbG5nJ10sIGZ1bmN0aW9uIChjb29yZGluYXRlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YXRjaEFkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoY29vcmRpbmF0ZXNbMF0gJiYgY29vcmRpbmF0ZXNbMF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2VNYXJrZXJCeUxhdExuZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2F0Y2hMYXRMbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHdhdGNoQWRkcmVzcyA9IHNjb3BlLiR3YXRjaEdyb3VwKFsnY2l0eScsICdjb3VudHJ5JywgJ3BsYWNlJ10sIGZ1bmN0aW9uIChhZGRyZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZGRyZXNzWzBdIHx8IGFkZHJlc3NbMV0gfHwgYWRkcmVzc1syXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2F0Y2hMYXRMbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlTWFya2VyQnlBZGRyZXNzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2F0Y2hBZGRyZXNzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBwbGFjZU1hcmtlckJ5TGF0TG5nKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxhdExuZyA9IHNjb3BlLmxhdCArICcsJyArIHNjb3BlLmxuZztcclxuXHJcbiAgICAgICAgICAgICAgICBsYXp5R29vZ2xlTWFwc1V0aWxzLnJldmVyc2VHZW9jb2RlKGxhdExuZykudGhlbihmdW5jdGlvbiAocGxhY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihwbGFjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzUGxhY2UocGxhY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBwbGFjZU1hcmtlckJ5QWRkcmVzcygpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhZGRyZXNzID0gKHNjb3BlLmNpdHkgfHwgJycpICsgJyAnICsgKHNjb3BlLmNvdW50cnkgfHwgJycpICsgJyAnICsgKHNjb3BlLnBsYWNlIHx8ICcnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsYXp5R29vZ2xlTWFwc1V0aWxzLmdlb2NvZGUoYWRkcmVzcykudGhlbihmdW5jdGlvbiAocGxhY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihwbGFjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzUGxhY2UocGxhY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcmVuZGVyUGxhY2VTZWFyY2goKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoSW5wdXQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhenktZ29vZ2xlLW1hcHMtc2VhcmNoLScgKyBzY29wZS4kaWQpKTtcclxuICAgICAgICAgICAgICAgIHZhciBzZWFyY2hCb3ggPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLlNlYXJjaEJveCgoc2VhcmNoSW5wdXQpKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZW5kZXJlZE1hcC5jb250cm9sc1ttYXBzLkNvbnRyb2xQb3NpdGlvbi5UT1BfTEVGVF0ucHVzaChzZWFyY2hJbnB1dCk7XHJcblxyXG4gICAgICAgICAgICAgICAgbWFwcy5ldmVudC5hZGRMaXN0ZW5lcihzZWFyY2hCb3gsICdwbGFjZXNfY2hhbmdlZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwbGFjZSA9IHNlYXJjaEJveC5nZXRQbGFjZXMoKVswXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwbGFjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzUGxhY2UocGxhY2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gYWRkQ2xpY2tMaXN0ZW5lcigpIHtcclxuICAgICAgICAgICAgICAgIG1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocmVuZGVyZWRNYXAsICdjbGljaycsIGZ1bmN0aW9uKHRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXRMbmcgPSB0YXJnZXQubGF0TG5nLkEgKyAnLCcgKyB0YXJnZXQubGF0TG5nLkY7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxhenlHb29nbGVNYXBzVXRpbHMucmV2ZXJzZUdlb2NvZGUobGF0TG5nKS50aGVuKGZ1bmN0aW9uIChwbGFjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihwbGFjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1BsYWNlKHBsYWNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzUGxhY2UocGxhY2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgYm91bmRzID0gbmV3IG1hcHMuTGF0TG5nQm91bmRzKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5mb1dpbmRvd0NvbnRlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0TWFya2VyKHBsYWNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpbmZvd2luZG93LmNsb3NlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKF8uaGFzKHBsYWNlLCAnZ2VvbWV0cnkudmlld3BvcnQuRGEnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVkTWFwLmZpdEJvdW5kcyhwbGFjZS5nZW9tZXRyeS52aWV3cG9ydCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF8uaGFzKHBsYWNlLCAnZ2VvbWV0cnkubG9jYXRpb24uQScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWRNYXAuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmVuZGVyZWRNYXAucGFuVG8ocGxhY2UuZ2VvbWV0cnkubG9jYXRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLnBsYWNlID0gcGxhY2UuZm9ybWF0dGVkX2FkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5sYXQgPSBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5BIHx8IHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLmxhdDtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmxuZyA9IHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLkYgfHwgcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubG5nO1xyXG5cclxuICAgICAgICAgICAgICAgIHByb2Nlc3NBZGRyZXNzQ29tcG9uZW50cyhwbGFjZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaW5mb1dpbmRvd0NvbnRlbnQgPSAnPGRpdj48c3Ryb25nPicgKyBzY29wZS5jaXR5ICsgJzwvc3Ryb25nPjxicj4nICsgc2NvcGUucGxhY2UgKyAnPC9kaXY+JztcclxuICAgICAgICAgICAgICAgIGluZm93aW5kb3cuc2V0Q29udGVudChpbmZvV2luZG93Q29udGVudCk7XHJcbiAgICAgICAgICAgICAgICBpbmZvd2luZG93Lm9wZW4ocmVuZGVyZWRNYXAsIG1hcmtlcik7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0TWFya2VyKHBsYWNlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWFya2VySW1hZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwbGFjZS5pY29uLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBtYXBzLlNpemUoNzEsIDcxKSxcclxuICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBtYXBzLlBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IG1hcHMuUG9pbnQoMTcsIDM0KSxcclxuICAgICAgICAgICAgICAgICAgICBzY2FsZWRTaXplOiBuZXcgbWFwcy5TaXplKDM1LCAzNSlcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbjtcclxuICAgICAgICAgICAgICAgIGlmIChwbGFjZS5pY29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyLnNldEljb24oKG1hcmtlckltYWdlKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBtYXJrZXIuc2V0UG9zaXRpb24ocG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgbWFya2VyLnNldFZpc2libGUodHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzQWRkcmVzc0NvbXBvbmVudHMocGxhY2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb3VudHJ5ID0gXy5maWx0ZXIocGxhY2UuYWRkcmVzc19jb21wb25lbnRzLCB7IHR5cGVzOiBbJ2NvdW50cnknXSB9KTtcclxuICAgICAgICAgICAgICAgIHZhciBjaXR5ID0gXy5maWx0ZXIocGxhY2UuYWRkcmVzc19jb21wb25lbnRzLCB7IHR5cGVzOiBbJ2xvY2FsaXR5J10gfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuY291bnRyeSA9IGNvdW50cnlbMF0gPyBjb3VudHJ5WzBdLmxvbmdfbmFtZSA6IHNjb3BlLnBsYWNlO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuY2l0eSA9IGNpdHlbMF0gPyBjaXR5WzBdLmxvbmdfbmFtZSA6IHNjb3BlLmNvdW50cnk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBsYXp5R29vZ2xlTWFwcy4kaW5qZWN0ID0gW1wiJHdpbmRvd1wiLCBcIiRxXCIsIFwiJHJvb3RTY29wZVwiLCBcImxhenlHb29nbGVNYXBzVXRpbHNcIl07XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdsYXp5R29vZ2xlTWFwcycpXG4gICAgICAgIC5mYWN0b3J5KCdsYXp5R29vZ2xlTWFwc1V0aWxzJywgbGF6eUdvb2dsZU1hcHNVdGlscyk7XG5cbiAgICBmdW5jdGlvbiBsYXp5R29vZ2xlTWFwc1V0aWxzKCRodHRwKSB7XG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIHJldmVyc2VHZW9jb2RlOiByZXZlcnNlR2VvY29kZSxcbiAgICAgICAgICAgIGdlb2NvZGU6IGdlb2NvZGVcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICBmdW5jdGlvbiByZXZlcnNlR2VvY29kZShsYXRMbmcpIHtcbiAgICAgICAgICAgIHZhciBnb29nbGVHZW9jb2RlU2VydmljZVVSTCA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uP2xhdGxuZz0nO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChnb29nbGVHZW9jb2RlU2VydmljZVVSTCArIGxhdExuZykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5yZXN1bHRzWzBdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGZ1bmN0aW9uIGdlb2NvZGUoYWRkcmVzcykge1xuICAgICAgICAgICAgdmFyIGdvb2dsZUdlb2NvZGVTZXJ2aWNlVVJMID0gJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24/YWRkcmVzcz0nO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChnb29nbGVHZW9jb2RlU2VydmljZVVSTCArIGFkZHJlc3MpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEucmVzdWx0c1swXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9XG4gICAgbGF6eUdvb2dsZU1hcHNVdGlscy4kaW5qZWN0ID0gW1wiJGh0dHBcIl07XG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9